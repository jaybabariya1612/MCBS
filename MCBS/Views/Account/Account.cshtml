@model MCBS.Models.AccountModel
<link href="~/css/account.css" rel="stylesheet" />
@{
    ViewData["Title"] = "Open Indian Bank Account";
}

<div class="account-container">
    <div class="account-card animate__animated animate__fadeIn">
        <div class="account-header">
            <div class="account-bank-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.25a.75.75 0 001 .707A8.237 8.237 0 016 18.75c1.995 0 3.823.707 5.25 1.886V4.533zM12.75 20.636A8.214 8.214 0 0118 18.75c.966 0 1.89.166 2.75.47a.75.75 0 001-.708V4.262a.75.75 0 00-.5-.707A9.735 9.735 0 0018 3a9.707 9.707 0 00-5.25 1.533v16.103z" />
                </svg>
                <h2>Open New Account</h2>
            </div>
            <p class="account-subtitle">Join India's fastest growing digital banking platform</p>
            
            <div class="account-progress">
                <div class="account-progress-track">
                    <div class="account-progress-fill" id="accountFormProgress"></div>
                </div>
                <span class="account-progress-text">0% complete</span>
            </div>
        </div>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="account-alert account-success animate__animated animate__fadeIn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                </svg>
                @TempData["SuccessMessage"]
            </div>
        }

        <form asp-action="Account" method="post" class="account-form" id="accountForm">
            <div class="account-form-sections">
                <!-- Personal Information Section -->
                <div class="account-form-section">
                    <div class="account-section-header">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <h3>Personal Information</h3>
                    </div>

                    <div class="account-form-grid">
                        <div class="account-input-group">
                            <label asp-for="AccountHolderName" class="account-input-label">Full Name</label>
                            <input asp-for="AccountHolderName" class="account-input" placeholder="Enter your full name" />
                            <span asp-validation-for="AccountHolderName" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="DateOfBirth" class="account-input-label">Date of Birth</label>
                            <input asp-for="DateOfBirth" class="account-input account-date-input" type="date" />
                            <span asp-validation-for="DateOfBirth" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="Gender" class="account-input-label">Gender</label>
                            <select asp-for="Gender" class="account-input account-select">
                                <option value="">-- Select Gender --</option>
                                <option>Male</option>
                                <option>Female</option>
                                <option>Other</option>
                            </select>
                            <span asp-validation-for="Gender" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="Occupation" class="account-input-label">Occupation</label>
                            <input asp-for="Occupation" class="account-input" placeholder="Your profession" />
                            <span asp-validation-for="Occupation" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="Nationality" class="account-input-label">Nationality</label>
                            <input asp-for="Nationality" class="account-input" placeholder="Your nationality" value="Indian" />
                            <span asp-validation-for="Nationality" class="account-input-error"></span>
                        </div>
                    </div>
                </div>

                <!-- Account Details Section -->
                <div class="account-form-section">
                    <div class="account-section-header">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                        </svg>
                        <h3>Account Details</h3>
                    </div>

                    <div class="account-form-grid">
                        <div class="account-input-group">
                            <label asp-for="AccountType" class="account-input-label">Account Type</label>
                            <select asp-for="AccountType" class="account-input account-select">
                                <option value="">-- Select Account Type --</option>
                                <option>Savings</option>
                                <option>Current</option>
                                <option>Fixed Deposit</option>
                                <option>Recurring Deposit</option>
                            </select>
                            <span asp-validation-for="AccountType" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="BranchName" class="account-input-label">Branch Name</label>
                            <input asp-for="BranchName" class="account-input" placeholder="Enter branch name" />
                            <span asp-validation-for="BranchName" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="IFSCCode" class="account-input-label">IFSC Code</label>
                            <input asp-for="IFSCCode" class="account-input" readonly />
                            <small class="account-input-hint">IFSC code will be auto-generated</small>
                            <span asp-validation-for="IFSCCode" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="AccountNumber" class="account-input-label">AccountNumber</label>
                            <input asp-for="AccountNumber" class="account-input" readonly />
                            <small class="account-input-hint">AccountNumber will be auto-generated</small>
                            <span asp-validation-for="AccountNumber" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="Balance" class="account-input-label">Initial Deposit (₹)</label>
                            <input asp-for="Balance" class="account-input" type="number" step="0.01" min="0" placeholder="Enter amount" />
                            <span asp-validation-for="Balance" class="account-input-error"></span>
                        </div>
                    </div>
                </div>

                <!-- Contact Information Section -->
                <div class="account-form-section">
                    <div class="account-section-header">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <h3>Contact Information</h3>
                    </div>

                    <div class="account-form-grid">
                        <div class="account-input-group">
                            <label asp-for="MobileNumber" class="account-input-label">Mobile Number</label>
                            <input asp-for="MobileNumber" class="account-input" placeholder="Enter 10-digit mobile number" />
                            <span asp-validation-for="MobileNumber" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="Email" class="account-input-label">Email Address</label>
                            <input asp-for="Email" class="account-input" type="email" placeholder="Enter your email" />
                            <span asp-validation-for="Email" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group account-input-full-width">
                            <label asp-for="Address" class="account-input-label">Full Address</label>
                            <textarea asp-for="Address" class="account-input account-textarea" rows="3" placeholder="Your complete address"></textarea>
                            <span asp-validation-for="Address" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="City" class="account-input-label">City</label>
                            <input asp-for="City" class="account-input" placeholder="Enter your city" />
                            <span asp-validation-for="City" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="State" class="account-input-label">State</label>
                            <input asp-for="State" class="account-input" placeholder="Enter your state" />
                            <span asp-validation-for="State" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="PostalCode" class="account-input-label">Postal Code</label>
                            <input asp-for="PostalCode" class="account-input" maxlength="10" placeholder="Enter postal code" />
                            <span asp-validation-for="PostalCode" class="account-input-error"></span>
                        </div>
                    </div>
                </div>

                <!-- KYC Details Section -->
                <div class="account-form-section">
                    <div class="account-section-header">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4" />
                        </svg>
                        <h3>KYC Details</h3>
                    </div>

                    <div class="account-form-grid">
                        <div class="account-input-group">
                            <label asp-for="AadhaarNumber" class="account-input-label">Aadhaar Number</label>
                            <input asp-for="AadhaarNumber" class="account-input" maxlength="12" placeholder="12-digit Aadhaar number" />
                            <span asp-validation-for="AadhaarNumber" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="PANNumber" class="account-input-label">PAN Number</label>
                            <input asp-for="PANNumber" class="account-input" maxlength="10" placeholder="10-digit PAN number" />
                            <span asp-validation-for="PANNumber" class="account-input-error"></span>
                        </div>

                        <div class="account-checkbox-group">
                            <label class="account-checkbox-label">
                                <input asp-for="KYCStatus" class="account-checkbox-input" />
                                <span class="account-checkbox-custom"></span>
                                <span class="account-checkbox-text">KYC Verified</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Nominee Information Section -->
                <div class="account-form-section">
                    <div class="account-section-header">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <h3>Nominee Information</h3>
                    </div>

                    <div class="account-form-grid">
                        <div class="account-input-group">
                            <label asp-for="NomineeName" class="account-input-label">Nominee Name</label>
                            <input asp-for="NomineeName" class="account-input" placeholder="Nominee full name" />
                            <span asp-validation-for="NomineeName" class="account-input-error"></span>
                        </div>

                        <div class="account-input-group">
                            <label asp-for="NomineeRelationship" class="account-input-label">Relationship</label>
                            <input asp-for="NomineeRelationship" class="account-input" placeholder="Relationship with nominee" />
                            <span asp-validation-for="NomineeRelationship" class="account-input-error"></span>
                        </div>
                    </div>
                </div>

                <!-- Form Submission -->
                <div class="account-form-section">
                    <div class="account-checkbox-group">
                        <label class="account-checkbox-label">
                            <input asp-for="IsActive" class="account-checkbox-input" checked />
                            <span class="account-checkbox-custom"></span>
                            <span class="account-checkbox-text">Activate Account Immediately</span>
                        </label>
                    </div>

                    <div class="account-form-actions">
                        <button type="submit" class="account-btn account-btn-primary">
                            <span class="account-btn-text">Open Account</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="account-btn-icon">
                                <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Form progress animation
            const form = document.getElementById('accountForm');
            const progressBar = document.getElementById('accountFormProgress');
            const progressText = document.querySelector('.account-progress-text');

            // Real-time validation for unique fields
            const debounce = (func, delay) => {
                let timeout;
                return function() {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            };

            // Check existing values in database
            const checkExistingValues = async (fieldName, value) => {
                if (!value || value.length < 3) return; // Don't check for very short values

                try {
                    const params = new URLSearchParams();
                    if (fieldName === 'Email') params.append('email', value);
                    if (fieldName === 'MobileNumber') params.append('mobileNumber', value);
                    if (fieldName === 'AadhaarNumber') params.append('aadhaarNumber', value);
                    if (fieldName === 'PANNumber') params.append('panNumber', value);

                    const response = await fetch(`/Account/CheckExistingValues?${params.toString()}`);
                    const data = await response.json();

                    // Find the input field and error span
                    const input = document.querySelector(`[name="${fieldName}"]`);
                    const errorSpan = document.querySelector(`[data-valmsg-for="${fieldName}"]`);

                    if (!input || !errorSpan) return;

                    if ((fieldName === 'Email' && data.EmailExists) ||
                        (fieldName === 'MobileNumber' && data.MobileExists) ||
                        (fieldName === 'AadhaarNumber' && data.AadhaarExists) ||
                        (fieldName === 'PANNumber' && data.PANExists)) {

                        // Add error message
                        errorSpan.textContent = `${fieldName} is already registered`;
                        errorSpan.style.display = 'block';
                        input.classList.add('input-validation-error');

                        // Add shake animation
                        input.classList.add('animate__animated', 'animate__headShake');
                        setTimeout(() => {
                            input.classList.remove('animate__animated', 'animate__headShake');
                        }, 1000);
                    } else {
                        // Clear error if it was previously shown
                        if (errorSpan.textContent.includes('already registered')) {
                            errorSpan.textContent = '';
                            errorSpan.style.display = 'none';
                            input.classList.remove('input-validation-error');
                        }
                    }
                } catch (error) {
                    console.error('Error checking existing values:', error);
                }
            };

            // Set up debounced event listeners for each field
            const emailInput = document.querySelector('[name="Email"]');
            if (emailInput) {
                emailInput.addEventListener('input', debounce(() => {
                    checkExistingValues('Email', emailInput.value);
                }, 500));
            }

            const mobileInput = document.querySelector('[name="MobileNumber"]');
            if (mobileInput) {
                mobileInput.addEventListener('input', debounce(() => {
                    checkExistingValues('MobileNumber', mobileInput.value);
                }, 500));
            }

            const aadhaarInput = document.querySelector('[name="AadhaarNumber"]');
            if (aadhaarInput) {
                aadhaarInput.addEventListener('input', debounce(() => {
                    checkExistingValues('AadhaarNumber', aadhaarInput.value);
                }, 500));
            }

            const panInput = document.querySelector('[name="PANNumber"]');
            if (panInput) {
                panInput.addEventListener('input', debounce(() => {
                    checkExistingValues('PANNumber', panInput.value);
                }, 500));
            }

            // Calculate progress as user fills the form
            form.addEventListener('input', function() {
                const inputs = form.querySelectorAll('.account-input, .account-select, .account-textarea, .account-checkbox-input');
                let filledCount = 0;

                inputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        if (input.checked) filledCount++;
                    } else if (input.value.trim() !== '') {
                        filledCount++;
                    }
                });

                const progress = Math.round((filledCount / inputs.length) * 100);
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `${progress}% complete`;

                // Add pulse animation when progress increases
                if (progress > parseInt(progressBar.style.width || '0')) {
                    progressBar.classList.add('animate__animated', 'animate__pulse');
                    setTimeout(() => {
                        progressBar.classList.remove('animate__animated', 'animate__pulse');
                    }, 500);
                }
            });

            // Smooth scroll to errors if validation fails
            const firstError = document.querySelector('.account-input-error');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // Add animation to form sections when they come into view
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.account-form-section').forEach(section => {
                observer.observe(section);
            });

            // Special handling for date inputs
            document.querySelectorAll('.account-date-input').forEach(input => {
                // Initialize with focused class if value exists
                if (input.value) {
                    input.parentNode.classList.add('account-input-focused');
                }

                input.addEventListener('change', function() {
                    this.parentNode.classList.add('account-input-focused');
                });
            });
        });
    </script>
}